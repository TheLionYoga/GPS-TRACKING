<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pencatat Koordinat</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      height: 100%;
    }
    
    html {
      height: 100%;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .header h1 {
      margin: 0 0 16px 0;
      font-size: 28px;
      font-weight: 700;
      color: #1a202c;
    }
    
    .map-container {
      width: 100%;
      height: 200px;
      background: #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      margin-bottom: 16px;
    }
    
    #map {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      font-size: 14px;
    }
    
    .location-info {
      background: #f8fafc;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      color: #475569;
    }
    
    .location-info strong {
      color: #1e293b;
    }
    
    .save-section, .location-section, .saved-coordinates {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .save-form {
      background: #f8fafc;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #374151;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s ease;
      box-sizing: border-box;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    .form-select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s ease;
      box-sizing: border-box;
      background: white;
    }
    
    .form-select:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    .form-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s ease;
      box-sizing: border-box;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 8px;
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      font-weight: normal;
      color: #374151;
      cursor: pointer;
      margin-bottom: 0;
    }
    
    .checkbox-label input[type="checkbox"] {
      margin-right: 6px;
      width: auto;
      padding: 0;
    }
    
    .save-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 14px 28px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
      width: 100%;
    }
    
    .save-btn:hover:not(:disabled) {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }
    
    .save-btn:active {
      transform: translateY(0);
    }
    
    .save-btn:disabled {
      background: #94a3b8;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .location-details {
      background: #f8fafc;
      padding: 16px;
      border-radius: 12px;
    }
    
    .location-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .location-row:last-child {
      border-bottom: none;
    }
    
    .location-label {
      font-weight: 600;
      color: #475569;
    }
    
    .location-value {
      font-family: 'Courier New', monospace;
      color: #1e293b;
      font-weight: 500;
    }
    
    .coordinates-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .coordinate-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 16px;
      transition: all 0.2s ease;
    }
    
    .coordinate-card:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
    }
    
    .coordinate-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    
    .coordinate-time {
      font-size: 14px;
      color: #6b7280;
      font-weight: 500;
    }
    
    .coordinate-note {
      font-size: 16px;
      color: #1f2937;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .coordinate-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .coordinate-detail {
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 13px;
    }
    
    .coordinate-detail-label {
      color: #6b7280;
      font-weight: 500;
    }
    
    .coordinate-detail-value {
      color: #1f2937;
      font-family: 'Courier New', monospace;
      font-weight: 600;
    }
    
    .delete-btn {
      background: #ef4444;
      color: white;
      border: none;
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .delete-btn:hover:not(:disabled) {
      background: #dc2626;
    }
    
    .delete-btn:disabled {
      background: #94a3b8;
      cursor: not-allowed;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #94a3b8;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    .maps-btn {
      background: #4285f4;
      color: white;
      border: none;
      padding: 8px 16px;
      font-size: 12px;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-block;
    }
    
    .maps-btn:hover:not(:disabled) {
      background: #3367d6;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(66, 133, 244, 0.3);
    }
    
    .maps-btn:disabled {
      background: #94a3b8;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #1e293b;
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }
    
    .gps-notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #f59e0b;
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      z-index: 1001;
      animation: slideDown 0.3s ease;
      max-width: 90%;
      text-align: center;
      font-weight: 600;
    }
    
    .gps-notification.error {
      background: #ef4444;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }
    
    .gps-notification.success {
      background: #10b981;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideDown {
      from {
        transform: translateX(-50%) translateY(-100px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }
    
    .manual-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .manual-content {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .dropdown-item {
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .dropdown-item:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
    }
    
    .dropdown-header {
      background: #f8fafc;
      padding: 16px 20px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      user-select: none;
    }
    
    .dropdown-header:hover {
      background: #f1f5f9;
    }
    
    .dropdown-header.active {
      background: #eff6ff;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .dropdown-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
      color: #1e293b;
      font-size: 16px;
    }
    
    .dropdown-icon {
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .dropdown-arrow {
      font-size: 14px;
      color: #64748b;
      transition: transform 0.3s ease;
      font-weight: bold;
    }
    
    .dropdown-arrow.rotated {
      transform: rotate(180deg);
    }
    
    .dropdown-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background: white;
    }
    
    .dropdown-content.open {
      max-height: 2000px;
    }
    
    .manual-card {
      background: white;
      padding: 20px;
      margin: 0;
      border: none;
      border-radius: 0;
    }
    
    .manual-card h3 {
      margin: 0 0 16px 0;
      font-size: 20px;
      font-weight: 700;
      color: #1e293b;
    }
    
    .manual-card h4 {
      margin: 0 0 12px 0;
      font-size: 16px;
      font-weight: 600;
      color: #374151;
    }
    
    .manual-card p {
      margin: 0 0 12px 0;
      line-height: 1.6;
      color: #475569;
    }
    
    .manual-card ul {
      margin: 8px 0;
      padding-left: 20px;
      color: #475569;
    }
    
    .manual-card li {
      margin-bottom: 4px;
      line-height: 1.5;
    }
    
    .step-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .step-item {
      display: flex;
      gap: 16px;
      align-items: flex-start;
    }
    
    .step-number {
      background: #3b82f6;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .step-content {
      flex: 1;
    }
    
    .step-content strong {
      display: block;
      margin-bottom: 4px;
      color: #1e293b;
      font-size: 16px;
    }
    
    .step-content p {
      margin: 0;
      color: #64748b;
      line-height: 1.5;
    }
    
    .offline-info {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .info-box {
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid;
    }
    
    .info-box.success {
      background: #f0fdf4;
      border-left-color: #22c55e;
    }
    
    .info-box.warning {
      background: #fffbeb;
      border-left-color: #f59e0b;
    }
    
    .info-box.info {
      background: #eff6ff;
      border-left-color: #3b82f6;
    }
    
    .info-box h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 600;
    }
    
    .info-box ul {
      margin: 0;
      padding-left: 16px;
    }
    
    .info-box li {
      margin-bottom: 2px;
      font-size: 14px;
    }
    
    .tips-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }
    
    .tip-item {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      background: white;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    
    .tip-icon {
      font-size: 24px;
      flex-shrink: 0;
    }
    
    .tip-item strong {
      display: block;
      margin-bottom: 4px;
      color: #1e293b;
      font-size: 14px;
    }
    
    .tip-item p {
      margin: 0;
      font-size: 13px;
      color: #64748b;
      line-height: 1.4;
    }
    
    .troubleshoot-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .trouble-item {
      background: white;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    
    .trouble-item strong {
      display: block;
      margin-bottom: 8px;
      color: #dc2626;
      font-size: 14px;
    }
    
    .trouble-item ul {
      margin: 0;
      padding-left: 16px;
    }
    
    .trouble-item li {
      margin-bottom: 4px;
      font-size: 13px;
      color: #475569;
    }
    
    .data-format {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
      margin-top: 12px;
    }
    
    .format-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    
    .format-row:last-child {
      border-bottom: none;
    }
    
    .format-label {
      font-weight: 600;
      color: #374151;
      font-size: 14px;
    }
    
    .format-value {
      color: #64748b;
      font-size: 14px;
      font-style: italic;
    }
    
    .important-notes {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .note-item {
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid;
    }
    
    .note-item.danger {
      background: #fef2f2;
      border-left-color: #ef4444;
    }
    
    .note-item.success {
      background: #f0fdf4;
      border-left-color: #22c55e;
    }
    
    .note-item strong {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .note-item ul {
      margin: 0;
      padding-left: 16px;
    }
    
    .note-item li {
      margin-bottom: 4px;
      font-size: 13px;
      color: #475569;
    }
    
    @media (max-width: 640px) {
      .container {
        padding: 12px;
      }
      
      .header, .save-section, .location-section, .saved-coordinates, .manual-section {
        padding: 16px;
      }
      
      .header h1 {
        font-size: 24px;
      }
      
      .coordinate-details {
        grid-template-columns: 1fr;
      }
      
      .tips-grid {
        grid-template-columns: 1fr;
      }
      
      .step-item {
        flex-direction: column;
        gap: 8px;
      }
      
      .step-number {
        align-self: flex-start;
      }
      
      .format-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1 id="appTitle">Pencatat Koordinat</h1>
    <div class="map-container">
     <div id="map">
      üìç Menunggu lokasi...
     </div>
    </div>
    <div class="location-info" id="locationInfo"><strong>Lokasi Saat Ini:</strong> Memuat...
    </div>
    <div class="offline-tips" id="offlineTips" style="display: none;">
     <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-top: 12px;"><strong>üí° Tips GPS Offline:</strong><br>
       ‚Ä¢ Pastikan berada di area terbuka (tidak di dalam gedung)<br>
       ‚Ä¢ Tunggu 1-3 menit untuk sinyal satelit GPS<br>
       ‚Ä¢ Hindari area dengan banyak gedung tinggi<br>
       ‚Ä¢ GPS offline lebih akurat di siang hari
     </div>
    </div>
    <div class="offline-storage" id="offlineStorage" style="display: none;">
     <div style="background: #e0f2fe; border: 1px solid #0288d1; border-radius: 8px; padding: 12px; margin-top: 12px;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
       <div><strong id="offlineCounter">üì¶ 0 data tersimpan offline</strong><br><small style="color: #0277bd;">Data akan otomatis dikirim saat internet tersambung</small>
       </div><button id="syncBtn" class="sync-btn" onclick="manualSync()" style="background: #0288d1; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px; cursor: pointer;"> üîÑ Sinkron Sekarang </button>
      </div>
     </div>
    </div>
   </div>
   <div class="manual-section">
    <h2 id="manualTitle">üìñ Manual Penggunaan Sistem</h2>
    <div class="manual-content"><!-- Dropdown Item 1: Tujuan Sistem -->
     <div class="dropdown-item">
      <div class="dropdown-header" onclick="toggleDropdown('tujuan')">
       <div class="dropdown-title"><span class="dropdown-icon">üéØ</span> <span>Tujuan Sistem</span>
       </div><span class="dropdown-arrow" id="arrow-tujuan">‚ñº</span>
      </div>
      <div class="dropdown-content" id="content-tujuan">
       <div class="manual-card">
        <p>Sistem Pencatat Koordinat dirancang untuk membantu petugas lapangan mencatat lokasi GPS fasilitas pendidikan dan kesehatan di daerah terpencil, bahkan tanpa koneksi internet.</p>
       </div>
      </div>
     </div><!-- Dropdown Item 2: Cara Memulai -->
     <div class="dropdown-item">
      <div class="dropdown-header" onclick="toggleDropdown('memulai')">
       <div class="dropdown-title"><span class="dropdown-icon">üöÄ</span> <span>Cara Memulai</span>
       </div><span class="dropdown-arrow" id="arrow-memulai">‚ñº</span>
      </div>
      <div class="dropdown-content" id="content-memulai">
       <div class="manual-card">
        <div class="step-list">
         <div class="step-item"><span class="step-number">1</span>
          <div class="step-content"><strong>Aktifkan GPS</strong>
           <p>Pastikan GPS/Lokasi di perangkat Anda sudah diaktifkan. Buka Pengaturan ‚Üí Lokasi ‚Üí Aktifkan.</p>
          </div>
         </div>
         <div class="step-item"><span class="step-number">2</span>
          <div class="step-content"><strong>Izinkan Akses Lokasi</strong>
           <p>Saat diminta, pilih "Izinkan" untuk memberikan akses lokasi ke aplikasi ini.</p>
          </div>
         </div>
         <div class="step-item"><span class="step-number">3</span>
          <div class="step-content"><strong>Tunggu Sinyal GPS</strong>
           <p>Aplikasi akan mencari lokasi Anda. Proses ini membutuhkan 10-60 detik tergantung kondisi sinyal.</p>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Dropdown Item 3: Cara Mencatat Koordinat -->
     <div class="dropdown-item">
      <div class="dropdown-header" onclick="toggleDropdown('mencatat')">
       <div class="dropdown-title"><span class="dropdown-icon">üìç</span> <span>Cara Mencatat Koordinat</span>
       </div><span class="dropdown-arrow" id="arrow-mencatat">‚ñº</span>
      </div>
      <div class="dropdown-content" id="content-mencatat">
       <div class="manual-card">
        <div class="step-list">
         <div class="step-item"><span class="step-number">1</span>
          <div class="step-content"><strong>Pastikan Lokasi Terdeteksi</strong>
           <p>Lihat bagian "Informasi Lokasi Realtime". Pastikan koordinat sudah muncul dan akurasi GPS baik (di bawah 10 meter).</p>
          </div>
         </div>
         <div class="step-item"><span class="step-number">2</span>
          <div class="step-content"><strong>Isi Data Lokasi</strong>
           <p>Pilih Kecamatan dan Desa dari dropdown. Jika tidak ada, pilih "Lainnya" dan ketik manual.</p>
          </div>
         </div>
         <div class="step-item"><span class="step-number">3</span>
          <div class="step-content"><strong>Pilih Jenis Layanan</strong>
           <p><strong>PENTING:</strong> Pilih HANYA SATU jenis layanan per lokasi:</p>
           <ul>
            <li><strong>Layanan Pendidikan:</strong> SD, SMP, SMA, SMK, SLB</li>
            <li><strong>Layanan Kesehatan:</strong> Pustu, Puskesmas</li>
           </ul>
           <p>Setelah memilih satu, yang lain akan terkunci otomatis.</p>
          </div>
         </div>
         <div class="step-item"><span class="step-number">4</span>
          <div class="step-content"><strong>Isi Nama Layanan</strong>
           <p>Ketik nama lengkap fasilitas (contoh: "SD Negeri 1 Nanga Pinoh" atau "Puskesmas Pembantu Langan").</p>
          </div>
         </div>
         <div class="step-item"><span class="step-number">5</span>
          <div class="step-content"><strong>Isi Data Infrastruktur</strong>
           <p>Pilih kondisi sinyal telekomunikasi, akses PLN, dan jangkauan sinyal di lokasi tersebut.</p>
          </div>
         </div>
         <div class="step-item"><span class="step-number">6</span>
          <div class="step-content"><strong>Simpan Data</strong>
           <p>Klik tombol "üìç Simpan Koordinat". Data akan tersimpan otomatis.</p>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Dropdown Item 4: Mode Offline -->
     <div class="dropdown-item">
      <div class="dropdown-header" onclick="toggleDropdown('offline')">
       <div class="dropdown-title"><span class="dropdown-icon">üì°</span> <span>Mode Offline (Tanpa Internet)</span>
       </div><span class="dropdown-arrow" id="arrow-offline">‚ñº</span>
      </div>
      <div class="dropdown-content" id="content-offline">
       <div class="manual-card">
        <div class="offline-info">
         <div class="info-box success">
          <h4>‚úÖ Yang Bisa Dilakukan Offline:</h4>
          <ul>
           <li>Mendapatkan koordinat GPS (menggunakan satelit)</li>
           <li>Mengisi dan menyimpan semua data formulir</li>
           <li>Melihat data yang tersimpan offline</li>
           <li>Aplikasi tetap berfungsi 100%</li>
          </ul>
         </div>
         <div class="info-box warning">
          <h4>‚ö†Ô∏è Keterbatasan Offline:</h4>
          <ul>
           <li>Data tidak langsung terkirim ke Google Sheets</li>
           <li>GPS membutuhkan waktu lebih lama (1-3 menit)</li>
           <li>Tidak bisa membuka Google Maps</li>
          </ul>
         </div>
         <div class="info-box info">
          <h4>üîÑ Auto-Sync Saat Online:</h4>
          <ul>
           <li>Data offline otomatis terkirim saat internet tersambung</li>
           <li>Bisa sync manual dengan tombol "üîÑ Sinkron Sekarang"</li>
           <li>Counter menunjukkan jumlah data yang belum terkirim</li>
          </ul>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Dropdown Item 5: Tips GPS -->
     <div class="dropdown-item">
      <div class="dropdown-header" onclick="toggleDropdown('tips')">
       <div class="dropdown-title"><span class="dropdown-icon">üí°</span> <span>Tips GPS di Daerah Terpencil</span>
       </div><span class="dropdown-arrow" id="arrow-tips">‚ñº</span>
      </div>
      <div class="dropdown-content" id="content-tips">
       <div class="manual-card">
        <div class="tips-grid">
         <div class="tip-item"><span class="tip-icon">üå§Ô∏è</span>
          <div><strong>Waktu Terbaik</strong>
           <p>Gunakan siang hari (09:00-15:00) untuk akurasi GPS terbaik.</p>
          </div>
         </div>
         <div class="tip-item"><span class="tip-icon">üèûÔ∏è</span>
          <div><strong>Lokasi Ideal</strong>
           <p>Berdiri di area terbuka, jauh dari gedung tinggi atau pepohonan lebat.</p>
          </div>
         </div>
         <div class="tip-item"><span class="tip-icon">‚è±Ô∏è</span>
          <div><strong>Bersabar</strong>
           <p>Tanpa internet, GPS butuh 1-3 menit untuk mengunci satelit.</p>
          </div>
         </div>
         <div class="tip-item"><span class="tip-icon">üîã</span>
          <div><strong>Hemat Baterai</strong>
           <p>GPS menguras baterai. Bawa power bank untuk survei panjang.</p>
          </div>
         </div>
         <div class="tip-item"><span class="tip-icon">üì±</span>
          <div><strong>Mode Pesawat</strong>
           <p>Jika tidak ada sinyal, aktifkan mode pesawat lalu aktifkan GPS saja.</p>
          </div>
         </div>
         <div class="tip-item"><span class="tip-icon">üéØ</span>
          <div><strong>Akurasi</strong>
           <p>Tunggu hingga akurasi GPS di bawah 10 meter sebelum menyimpan.</p>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Dropdown Item 6: Troubleshooting -->
     <div class="dropdown-item">
      <div class="dropdown-header" onclick="toggleDropdown('troubleshoot')">
       <div class="dropdown-title"><span class="dropdown-icon">üîß</span> <span>Troubleshooting</span>
       </div><span class="dropdown-arrow" id="arrow-troubleshoot">‚ñº</span>
      </div>
      <div class="dropdown-content" id="content-troubleshoot">
       <div class="manual-card">
        <div class="troubleshoot-list">
         <div class="trouble-item"><strong>‚ùå GPS Tidak Terdeteksi</strong>
          <ul>
           <li>Pastikan GPS aktif di pengaturan perangkat</li>
           <li>Refresh halaman dan izinkan akses lokasi</li>
           <li>Pindah ke area yang lebih terbuka</li>
           <li>Tunggu 2-3 menit untuk sinyal satelit</li>
          </ul>
         </div>
         <div class="trouble-item"><strong>üì∂ Akurasi GPS Buruk (&gt;50m)</strong>
          <ul>
           <li>Pindah ke area terbuka tanpa penghalang</li>
           <li>Tunggu beberapa menit hingga sinyal stabil</li>
           <li>Hindari area dengan banyak gedung tinggi</li>
          </ul>
         </div>
         <div class="trouble-item"><strong>üíæ Data Tidak Tersimpan</strong>
          <ul>
           <li>Pastikan semua field wajib sudah diisi</li>
           <li>Cek apakah GPS sudah terdeteksi</li>
           <li>Jika offline, data akan tersimpan lokal</li>
          </ul>
         </div>
         <div class="trouble-item"><strong>üîÑ Sinkronisasi Gagal</strong>
          <ul>
           <li>Pastikan ada koneksi internet</li>
           <li>Coba sync manual dengan tombol sinkron</li>
           <li>Data akan otomatis sync saat online</li>
          </ul>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Dropdown Item 7: Hasil Data -->
     <div class="dropdown-item">
      <div class="dropdown-header" onclick="toggleDropdown('hasil')">
       <div class="dropdown-title"><span class="dropdown-icon">üìä</span> <span>Format Hasil Data</span>
       </div><span class="dropdown-arrow" id="arrow-hasil">‚ñº</span>
      </div>
      <div class="dropdown-content" id="content-hasil">
       <div class="manual-card">
        <p>Semua data yang disimpan akan dikirim ke Google Sheets dengan format:</p>
        <div class="data-format">
         <div class="format-row"><span class="format-label">Kecamatan:</span> <span class="format-value">Nama kecamatan</span>
         </div>
         <div class="format-row"><span class="format-label">Desa:</span> <span class="format-value">Nama desa</span>
         </div>
         <div class="format-row"><span class="format-label">Jenis Layanan:</span> <span class="format-value">Pendidikan/Kesehatan</span>
         </div>
         <div class="format-row"><span class="format-label">Nama Fasilitas:</span> <span class="format-value">Nama lengkap fasilitas</span>
         </div>
         <div class="format-row"><span class="format-label">Koordinat:</span> <span class="format-value">Latitude, Longitude</span>
         </div>
         <div class="format-row"><span class="format-label">Infrastruktur:</span> <span class="format-value">Sinyal, PLN, Jangkauan</span>
         </div>
         <div class="format-row"><span class="format-label">Waktu:</span> <span class="format-value">Timestamp pencatatan</span>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Dropdown Item 8: Hal Penting -->
     <div class="dropdown-item">
      <div class="dropdown-header" onclick="toggleDropdown('penting')">
       <div class="dropdown-title"><span class="dropdown-icon">‚ö†Ô∏è</span> <span>Hal Penting</span>
       </div><span class="dropdown-arrow" id="arrow-penting">‚ñº</span>
      </div>
      <div class="dropdown-content" id="content-penting">
       <div class="manual-card">
        <div class="important-notes">
         <div class="note-item danger"><strong>üö´ Jangan:</strong>
          <ul>
           <li>Mencatat lokasi yang sama berulang kali</li>
           <li>Mengisi data pendidikan DAN kesehatan sekaligus</li>
           <li>Menyimpan koordinat dengan akurasi buruk (&gt;20m)</li>
          </ul>
         </div>
         <div class="note-item success"><strong>‚úÖ Lakukan:</strong>
          <ul>
           <li>Satu lokasi = satu jenis layanan saja</li>
           <li>Pastikan nama fasilitas lengkap dan benar</li>
           <li>Tunggu GPS akurat sebelum menyimpan</li>
           <li>Backup data dengan sync berkala</li>
          </ul>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
   <div class="location-section">
    <h2 id="locationTitle">Informasi Lokasi Realtime</h2>
    <div class="location-details" id="locationDetails">
     <div class="location-row"><span class="location-label">üìç Latitude:</span> <span class="location-value" id="latValue">-</span>
     </div>
     <div class="location-row"><span class="location-label">üìç Longitude:</span> <span class="location-value" id="lngValue">-</span>
     </div>
     <div class="location-row"><span class="location-label">üéØ Akurasi:</span> <span class="location-value" id="accuracyValue">-</span>
     </div>
     <div class="location-row"><span class="location-label">üïí Update:</span> <span class="location-value" id="timeValue">-</span>
     </div>
     <div class="location-row"><span class="location-label">üó∫Ô∏è Maps:</span> <button id="openMapsBtn" class="maps-btn" onclick="openGoogleMaps()">Buka di Google Maps</button>
     </div>
    </div>
   </div>
   <div class="save-section">
    <h2 id="saveTitle">Simpan Koordinat</h2>
    <div class="save-form">
     <div class="form-group"><label for="kecamatanSelect">üèõÔ∏è Kecamatan:</label> <select id="kecamatanSelect" class="form-select"> <option value="">Pilih Kecamatan</option> <option value="BELIMBING">BELIMBING</option> <option value="BELIMBING HULU">BELIMBING HULU</option> <option value="ELLA HILIR">ELLA HILIR</option> <option value="MENUKUNG">MENUKUNG</option> <option value="NANGA PINOH">NANGA PINOH</option> <option value="PINOH SELATAN">PINOH SELATAN</option> <option value="PINOH UTARA">PINOH UTARA</option> <option value="SAYAN">SAYAN</option> <option value="SOKAN">SOKAN</option> <option value="TANAH PINOH">TANAH PINOH</option> <option value="TANAH PINOH BARAT">TANAH PINOH BARAT</option> <option value="lainnya">Lainnya</option> </select> <input type="text" id="kecamatanCustom" placeholder="Masukkan nama kecamatan..." style="display: none; margin-top: 8px;" class="form-input">
     </div>
     <div class="form-group"><label for="desaSelect">üèòÔ∏è Desa:</label> <select id="desaSelect" class="form-select"> <option value="">Pilih Desa</option> <option value="LANGAN">LANGAN</option> <option value="NANGA PAU">NANGA PAU</option> <option value="NANGA ENTEBAH">NANGA ENTEBAH</option> <option value="KAYU BUNGA">KAYU BUNGA</option> <option value="NANGA KALAN">NANGA KALAN</option> <option value="PEREMBANG NYURUH">PEREMBANG NYURUH</option> <option value="KERANGAN KORA">KERANGAN KORA</option> <option value="NANGA NYURUH">NANGA NYURUH</option> <option value="KAHIYA">KAHIYA</option> <option value="BEMBAN PERMAI">BEMBAN PERMAI</option> <option value="SUNGAI LABUK">SUNGAI LABUK</option> <option value="TANJUNG BERINGIN">TANJUNG BERINGIN</option> <option value="SAMPAK">SAMPAK</option> <option value="PELAIK KERUAP">PELAIK KERUAP</option> <option value="BATU ONAP">BATU ONAP</option> <option value="BELABAN ELLA">BELABAN ELLA</option> <option value="NANGA KAYAN">NANGA KAYAN</option> <option value="PAAL">PAAL</option> <option value="PELINGGANG">PELINGGANG</option> <option value="BINA JAYA">BINA JAYA</option> <option value="NYANGGAI">NYANGGAI</option> <option value="SENEMPAK">SENEMPAK</option> <option value="MANDAU BARU">MANDAU BARU</option> <option value="NANGA KELAWAI">NANGA KELAWAI</option> <option value="LANDAU GARONG">LANDAU GARONG</option> <option value="SUNGAI BAKAH">SUNGAI BAKAH</option> <option value="KAYAN SEMAPAU">KAYAN SEMAPAU</option> <option value="BEROBAI PERMAI">BEROBAI PERMAI</option> <option value="BORA">BORA</option> <option value="MEKAR PELITA">MEKAR PELITA</option> <option value="META BERSATU">META BERSATU</option> <option value="SILING PERMAI">SILING PERMAI</option> <option value="TUMBAK RAYA">TUMBAK RAYA</option> <option value="NANGA RAKU">NANGA RAKU</option> <option value="PEKAWAI">PEKAWAI</option> <option value="NANGA KOMPI">NANGA KOMPI</option> <option value="NANGA PAK">NANGA PAK</option> <option value="KARANGAN PURUN">KARANGAN PURUN</option> <option value="LANDAU SANDAK">LANDAU SANDAK</option> <option value="NANGA MANCUR">NANGA MANCUR</option> <option value="TANJUNG MAHUNG">TANJUNG MAHUNG</option> <option value="NANGA POTAI">NANGA POTAI</option> <option value="NANGA ORA">NANGA ORA</option> <option value="PENYENGKUANG">PENYENGKUANG</option> <option value="TELAGA RAYA">TELAGA RAYA</option> <option value="NANGA LIBAS">NANGA LIBAS</option> <option value="TELUK PONGKAL">TELUK PONGKAL</option> <option value="SIJAU">SIJAU</option> <option value="NANGA BETANGAI">NANGA BETANGAI</option> <option value="KELUING TAJA">KELUING TAJA</option> <option value="MARIS PERMAI">MARIS PERMAI</option> <option value="HARAPAN JAYA">HARAPAN JAYA</option> <option value="KELUAS HULU">KELUAS HULU</option> <option value="LAJA">LAJA</option> <option value="BUKIT RAYA">BUKIT RAYA</option> <option value="LINTAH TAUM">LINTAH TAUM</option> <option value="TOGAN BARU">TOGAN BARU</option> <option value="GANJANG">GANJANG</option> <option value="DURIAN JAYA">DURIAN JAYA</option> <option value="PELITA JAYA">PELITA JAYA</option> <option value="ULAK MUID">ULAK MUID</option> <option value="lainnya">Lainnya</option> </select> <input type="text" id="desaCustom" placeholder="Masukkan nama desa..." style="display: none; margin-top: 8px;" class="form-input">
     </div>
     <div class="form-group"><label for="pendidikanSelect">üéì Layanan Pendidikan:</label> <select id="pendidikanSelect" class="form-select"> <option value="">Pilih Layanan Pendidikan</option> <option value="SD">SD</option> <option value="SMP">SMP</option> <option value="SMA">SMA</option> <option value="SMK">SMK</option> <option value="SLB">SLB</option> <option value="lainnya">Lainnya</option> </select> <input type="text" id="pendidikanCustom" placeholder="Masukkan layanan pendidikan..." style="display: none; margin-top: 8px;" class="form-input"> <input type="text" id="namaLayananPendidikan" placeholder="Nama layanan pendidikan..." class="form-input" style="margin-top: 8px;">
     </div>
     <div class="form-group"><label for="kesehatanSelect">üè• Layanan Kesehatan:</label> <select id="kesehatanSelect" class="form-select"> <option value="">Pilih Layanan Kesehatan</option> <option value="Pustu">Pustu</option> <option value="Puskesmas">Puskesmas</option> <option value="lainnya">Lainnya</option> </select> <input type="text" id="kesehatanCustom" placeholder="Masukkan layanan kesehatan..." style="display: none; margin-top: 8px;" class="form-input"> <input type="text" id="namaLayananKesehatan" placeholder="Nama layanan kesehatan..." class="form-input" style="margin-top: 8px;">
     </div>
     <div class="form-group"><label for="sinyalSelect">üì∂ Sinyal Telekomunikasi:</label> <select id="sinyalSelect" class="form-select"> <option value="">Pilih Sinyal</option> <option value="Tidak Ada Sinyal">Tidak Ada Sinyal</option> <option value="2G">2G</option> <option value="3G">3G</option> <option value="4G">4G</option> </select>
     </div>
     <div class="form-group"><label for="plnSelect">‚ö° Akses PLN:</label> <select id="plnSelect" class="form-select"> <option value="">Pilih Status</option> <option value="Ada">Ada</option> <option value="Tidak Ada">Tidak Ada</option> </select>
     </div>
     <div class="form-group"><label for="jangkauanSelect">üì° Jangkauan Sinyal:</label> <select id="jangkauanSelect" class="form-select"> <option value="">Pilih Jangkauan</option> <option value="Sebagian">Sebagian</option> <option value="Seluruh Wilayah Desa">Seluruh Wilayah Desa</option> </select>
     </div><button class="save-btn" id="saveBtn">üìç Simpan Koordinat</button>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: "Pencatat Koordinat",
      save_button_text: "Simpan Koordinat",
      empty_message: "Belum ada koordinat yang disimpan",
      location_title: "Informasi Lokasi Realtime",
      manual_title: "Manual Penggunaan Sistem",
      primary_color: "#10b981",
      background_gradient_start: "#667eea",
      background_gradient_end: "#764ba2",
      text_color: "#1a202c",
      font_family: "Inter",
      font_size: 16
    };
    
    let currentLocation = null;
    let locationWatchId = null;
    let savedCoordinates = [];
    
    const dataHandler = {
      onDataChanged(data) {
        savedCoordinates = data;
      }
    };
    
    async function onConfigChange(config) {
      const appTitle = config.app_title || defaultConfig.app_title;
      const saveButtonText = config.save_button_text || defaultConfig.save_button_text;
      const emptyMessage = config.empty_message || defaultConfig.empty_message;
      const locationTitle = config.location_title || defaultConfig.location_title;
      const manualTitle = config.manual_title || defaultConfig.manual_title;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const bgStart = config.background_gradient_start || defaultConfig.background_gradient_start;
      const bgEnd = config.background_gradient_end || defaultConfig.background_gradient_end;
      const textColor = config.text_color || defaultConfig.text_color;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;
      
      document.getElementById('appTitle').textContent = appTitle;
      document.getElementById('saveBtn').innerHTML = `üìç ${saveButtonText}`;
      document.getElementById('locationTitle').textContent = locationTitle;
      document.getElementById('manualTitle').textContent = `üìñ ${manualTitle}`;
      
      document.body.style.background = `linear-gradient(135deg, ${bgStart} 0%, ${bgEnd} 100%)`;
      document.body.style.fontFamily = `'${fontFamily}', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      
      document.getElementById('saveBtn').style.background = primaryColor;
      
      const headers = document.querySelectorAll('h1, h2');
      headers.forEach(h => {
        h.style.color = textColor;
        if (h.tagName === 'H1') {
          h.style.fontSize = `${fontSize * 1.75}px`;
        } else {
          h.style.fontSize = `${fontSize * 1.375}px`;
        }
      });
      
      document.body.style.fontSize = `${fontSize}px`;
    }
    
    function showToast(message) {
      const existingToast = document.querySelector('.toast');
      if (existingToast) {
        existingToast.remove();
      }
      
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }
    
    function showGPSNotification(message, type = 'warning') {
      const existingNotification = document.querySelector('.gps-notification');
      if (existingNotification) {
        existingNotification.remove();
      }
      
      const notification = document.createElement('div');
      notification.className = `gps-notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Auto remove after 5 seconds for warnings, 3 seconds for success
      const timeout = type === 'warning' ? 5000 : 3000;
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, timeout);
    }
    
    function updateLocationDisplay() {
      const locationInfo = document.getElementById('locationInfo');
      const mapDiv = document.getElementById('map');
      const latValue = document.getElementById('latValue');
      const lngValue = document.getElementById('lngValue');
      const accuracyValue = document.getElementById('accuracyValue');
      const timeValue = document.getElementById('timeValue');
      const mapsBtn = document.getElementById('openMapsBtn');
      
      if (currentLocation) {
        const offlineStatus = currentLocation.isOffline ? ' üì° (Mode Offline)' : ' üåê (Online)';
        locationInfo.innerHTML = `<strong>Lokasi Saat Ini:</strong> ${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}${offlineStatus}`;
        
        const mapStatus = currentLocation.isOffline ? 'üì° GPS Murni' : 'üåê GPS + Internet';
        mapDiv.innerHTML = `üìç Lat: ${currentLocation.latitude.toFixed(4)}, Lng: ${currentLocation.longitude.toFixed(4)} | ${mapStatus}`;
        
        latValue.textContent = currentLocation.latitude.toFixed(8);
        lngValue.textContent = currentLocation.longitude.toFixed(8);
        accuracyValue.textContent = currentLocation.accuracy ? `¬±${currentLocation.accuracy.toFixed(0)}m` : 'N/A';
        timeValue.textContent = new Date().toLocaleTimeString('id-ID');
        
        // Enable maps button (works offline too, will open when internet available)
        mapsBtn.disabled = false;
        if (currentLocation.isOffline) {
          mapsBtn.textContent = 'Buka Maps (Butuh Internet)';
        } else {
          mapsBtn.textContent = 'Buka di Google Maps';
        }
      } else {
        const connectionStatus = checkInternetConnection() ? 'Online' : 'Offline';
        locationInfo.innerHTML = `<strong>Lokasi Saat Ini:</strong> Tidak tersedia (${connectionStatus})`;
        mapDiv.innerHTML = `üìç Mencari lokasi... (${connectionStatus})`;
        
        latValue.textContent = '-';
        lngValue.textContent = '-';
        accuracyValue.textContent = '-';
        timeValue.textContent = '-';
        
        // Disable maps button
        mapsBtn.disabled = true;
        mapsBtn.textContent = 'Lokasi tidak tersedia';
      }
    }
    
    function openGoogleMaps() {
      if (!currentLocation) {
        showToast('Lokasi belum terdeteksi');
        return;
      }
      
      const lat = currentLocation.latitude;
      const lng = currentLocation.longitude;
      const mapsUrl = `https://www.google.com/maps?q=${lat},${lng}&z=15`;
      
      // Open in new tab
      window.open(mapsUrl, '_blank', 'noopener,noreferrer');
      showToast('üó∫Ô∏è Membuka Google Maps...');
    }
    
    function checkInternetConnection() {
      return navigator.onLine;
    }
    
    function startLocationWatch() {
      if ('geolocation' in navigator) {
        const isOnline = checkInternetConnection();
        
        if (isOnline) {
          showGPSNotification('üìç Mencari lokasi GPS dengan bantuan internet...', 'warning');
        } else {
          showGPSNotification('üì° Mode Offline: Mencari lokasi GPS murni (tanpa internet). Proses mungkin lebih lama...', 'warning');
        }
        
        // Konfigurasi GPS untuk mode offline
        const gpsOptions = {
          enableHighAccuracy: true,
          maximumAge: isOnline ? 1000 : 30000, // Cache lebih lama jika offline
          timeout: isOnline ? 15000 : 60000    // Timeout lebih lama jika offline
        };
        
        locationWatchId = navigator.geolocation.watchPosition(
          (position) => {
            // First time getting location - show success notification
            if (!currentLocation) {
              const connectionStatus = checkInternetConnection() ? 'dengan internet' : 'tanpa internet (GPS murni)';
              showGPSNotification(`‚úÖ GPS berhasil diaktifkan ${connectionStatus}!`, 'success');
            }
            
            currentLocation = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
              accuracy: position.coords.accuracy,
              isOffline: !checkInternetConnection()
            };
            updateLocationDisplay();
          },
          (error) => {
            console.error('Error getting location:', error);
            
            let errorMessage = '';
            const isOffline = !checkInternetConnection();
            
            switch(error.code) {
              case error.PERMISSION_DENIED:
                errorMessage = 'üö´ Akses lokasi ditolak. Silakan aktifkan GPS dan izinkan akses lokasi.';
                break;
              case error.POSITION_UNAVAILABLE:
                if (isOffline) {
                  errorMessage = 'üì° GPS tidak dapat menemukan lokasi. Pastikan Anda berada di area terbuka dan tunggu lebih lama untuk sinyal satelit.';
                } else {
                  errorMessage = 'üìç Lokasi tidak tersedia. Pastikan GPS aktif dan Anda berada di area terbuka.';
                }
                break;
              case error.TIMEOUT:
                if (isOffline) {
                  errorMessage = '‚è±Ô∏è GPS membutuhkan waktu lebih lama tanpa internet. Tetap di area terbuka dan tunggu...';
                } else {
                  errorMessage = '‚è±Ô∏è Timeout mencari lokasi. Coba refresh halaman dan pastikan GPS aktif.';
                }
                break;
              default:
                errorMessage = isOffline ? 
                  '‚ùå GPS tidak dapat mengunci lokasi. Pastikan berada di area terbuka tanpa penghalang.' :
                  '‚ùå Tidak dapat mengakses lokasi. Pastikan GPS aktif.';
                break;
            }
            
            showGPSNotification(errorMessage, 'error');
            showToast('Tidak dapat mengakses lokasi');
          },
          gpsOptions
        );
        
        // Monitor perubahan koneksi internet
        window.addEventListener('online', () => {
          showGPSNotification('üåê Internet tersambung kembali - GPS akan lebih cepat', 'success');
          // Auto sync when back online
          autoSyncWhenOnline();
        });
        
        window.addEventListener('offline', () => {
          showGPSNotification('üì° Mode Offline: GPS akan menggunakan sinyal satelit murni', 'warning');
          // Show offline tips
          const offlineTips = document.getElementById('offlineTips');
          if (offlineTips) {
            offlineTips.style.display = 'block';
          }
        });
        
        window.addEventListener('online', () => {
          // Hide offline tips when back online
          const offlineTips = document.getElementById('offlineTips');
          if (offlineTips) {
            offlineTips.style.display = 'none';
          }
        });
        
        // Show tips immediately if already offline
        if (!checkInternetConnection()) {
          const offlineTips = document.getElementById('offlineTips');
          if (offlineTips) {
            offlineTips.style.display = 'block';
          }
        }
        
      } else {
        showGPSNotification('‚ùå Perangkat tidak mendukung GPS', 'error');
        showToast('Geolocation tidak didukung');
      }
    }
    
    function stopLocationWatch() {
      if (locationWatchId) {
        navigator.geolocation.clearWatch(locationWatchId);
        locationWatchId = null;
      }
    }
    
    // Google Apps Script URL - Ganti dengan URL Web App Anda
    const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxepvn4dywGjFYlCm0xRQ9ViqSQi8IYw3ARikOyoeC_Vd3TIIaXhHH4_MWDH2ToKWtA/exec';
    
    // Offline storage management
    function saveToOfflineStorage(data) {
      try {
        const offlineData = JSON.parse(localStorage.getItem('offlineCoordinates') || '[]');
        offlineData.push({
          ...data,
          offlineId: Date.now() + Math.random(),
          savedOffline: true,
          offlineTimestamp: new Date().toISOString()
        });
        localStorage.setItem('offlineCoordinates', JSON.stringify(offlineData));
        return true;
      } catch (error) {
        console.error('Error saving to offline storage:', error);
        return false;
      }
    }
    
    function getOfflineData() {
      try {
        return JSON.parse(localStorage.getItem('offlineCoordinates') || '[]');
      } catch (error) {
        console.error('Error reading offline data:', error);
        return [];
      }
    }
    
    function clearOfflineData() {
      try {
        localStorage.removeItem('offlineCoordinates');
        return true;
      } catch (error) {
        console.error('Error clearing offline data:', error);
        return false;
      }
    }
    
    function updateOfflineCounter() {
      const offlineData = getOfflineData();
      const counter = document.getElementById('offlineCounter');
      if (counter) {
        if (offlineData.length > 0) {
          counter.textContent = `üì¶ ${offlineData.length} data tersimpan offline`;
          counter.style.display = 'block';
        } else {
          counter.style.display = 'none';
        }
      }
    }
    
    async function syncOfflineData() {
      const offlineData = getOfflineData();
      if (offlineData.length === 0) return { success: true, synced: 0 };
      
      if (!checkInternetConnection()) {
        return { success: false, error: 'No internet connection' };
      }
      
      let syncedCount = 0;
      let failedCount = 0;
      const remainingData = [];
      
      for (const data of offlineData) {
        try {
          const result = await sendToGoogleSheets(data);
          if (result.success) {
            syncedCount++;
          } else {
            remainingData.push(data);
            failedCount++;
          }
        } catch (error) {
          remainingData.push(data);
          failedCount++;
        }
        
        // Small delay between requests
        await new Promise(resolve => setTimeout(resolve, 500));
      }
      
      // Update offline storage with remaining data
      localStorage.setItem('offlineCoordinates', JSON.stringify(remainingData));
      updateOfflineCounter();
      
      return { 
        success: syncedCount > 0, 
        synced: syncedCount, 
        failed: failedCount,
        remaining: remainingData.length
      };
    }
    
    async function sendToGoogleSheets(data) {
      try {
        const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        
        // Note: no-cors mode doesn't allow reading response, so we assume success
        return { success: true };
      } catch (error) {
        console.error('Error sending to Google Sheets:', error);
        return { success: false, error: error.message };
      }
    }
    
    async function saveCoordinate() {
      console.log('Save coordinate clicked');
      
      if (!currentLocation) {
        showToast('Lokasi belum terdeteksi. Tunggu sebentar...');
        return;
      }
      
      if (savedCoordinates.length >= 999) {
        showToast('Maksimal 999 koordinat. Hapus beberapa koordinat terlebih dahulu.');
        return;
      }
      
      const saveBtn = document.getElementById('saveBtn');
      
      // Get form values
      const kecamatanSelect = document.getElementById('kecamatanSelect');
      const kecamatanCustom = document.getElementById('kecamatanCustom');
      const desaSelect = document.getElementById('desaSelect');
      const desaCustom = document.getElementById('desaCustom');
      
      const kecamatan = kecamatanSelect.value === 'lainnya' ? kecamatanCustom.value : kecamatanSelect.value;
      const desa = desaSelect.value === 'lainnya' ? desaCustom.value : desaSelect.value;
      
      // Get layanan pendidikan
      const pendidikanSelect = document.getElementById('pendidikanSelect');
      const pendidikanCustom = document.getElementById('pendidikanCustom');
      const layananPendidikan = pendidikanSelect.value === 'lainnya' ? pendidikanCustom.value : pendidikanSelect.value;
      const namaLayananPendidikan = document.getElementById('namaLayananPendidikan').value.trim();
      
      // Get layanan kesehatan
      const kesehatanSelect = document.getElementById('kesehatanSelect');
      const kesehatanCustom = document.getElementById('kesehatanCustom');
      const layananKesehatan = kesehatanSelect.value === 'lainnya' ? kesehatanCustom.value : kesehatanSelect.value;
      const namaLayananKesehatan = document.getElementById('namaLayananKesehatan').value.trim();
      
      const sinyalTelekomunikasi = document.getElementById('sinyalSelect').value;
      const aksesPln = document.getElementById('plnSelect').value;
      const jangkauanSinyal = document.getElementById('jangkauanSelect').value;
      
      saveBtn.disabled = true;
      saveBtn.innerHTML = '<span class="loading"></span>Menyimpan...';
      
      const coordinateData = {
        id: Date.now().toString(),
        latitude: currentLocation.latitude,
        longitude: currentLocation.longitude,
        accuracy: currentLocation.accuracy || 0,
        timestamp: new Date().toISOString(),
        note: '',
        kecamatan: kecamatan || '',
        desa: desa || '',
        layanan_pendidikan: layananPendidikan || '',
        nama_layanan_pendidikan: namaLayananPendidikan || '',
        layanan_kesehatan: layananKesehatan || '',
        nama_layanan_kesehatan: namaLayananKesehatan || '',
        sinyal_telekomunikasi: sinyalTelekomunikasi || '',
        akses_pln: aksesPln || '',
        jangkauan_sinyal: jangkauanSinyal || ''
      };
      
      console.log('Data to save:', coordinateData);
      
      // Prepare data for Google Sheets (sesuai urutan yang diminta)
      const googleSheetsData = {
        kecamatan: coordinateData.kecamatan,
        desa: coordinateData.desa,
        layanan_pendidikan: coordinateData.layanan_pendidikan,
        nama_layanan_pendidikan: coordinateData.nama_layanan_pendidikan,
        layanan_kesehatan: coordinateData.layanan_kesehatan,
        nama_layanan_kesehatan: coordinateData.nama_layanan_kesehatan,
        sinyal_telekomunikasi: coordinateData.sinyal_telekomunikasi,
        akses_pln: coordinateData.akses_pln,
        jangkauan_sinyal: coordinateData.jangkauan_sinyal,
        latitude: coordinateData.latitude,
        longitude: coordinateData.longitude,
        timestamp: coordinateData.timestamp
      };
      
      console.log('Google Sheets data:', googleSheetsData);
      
      // Save to local storage (Data SDK) - silent operation
      if (window.dataSdk) {
        console.log('Saving to Data SDK...');
        try {
          const localResult = await window.dataSdk.create(coordinateData);
          console.log('Data SDK result:', localResult);
        } catch (error) {
          console.error('Error saving to Data SDK:', error);
        }
      }
      
      // Handle Google Sheets submission based on internet connection
      const isOnline = checkInternetConnection();
      
      if (isOnline) {
        // Try to send to Google Sheets
        console.log('Sending to Google Sheets...');
        const googleResult = await sendToGoogleSheets(googleSheetsData);
        console.log('Google Sheets result:', googleResult);
        
        if (googleResult.success) {
          showToast('üìç Data berhasil dikirim ke Google Sheets!');
        } else {
          // Failed to send online, save offline
          const offlineSaved = saveToOfflineStorage(googleSheetsData);
          if (offlineSaved) {
            showToast('üì¶ Data disimpan offline, akan dikirim saat internet tersambung');
            updateOfflineCounter();
            showOfflineStorage();
          } else {
            showToast('‚ö†Ô∏è Gagal menyimpan data');
          }
        }
      } else {
        // No internet, save offline
        const offlineSaved = saveToOfflineStorage(googleSheetsData);
        if (offlineSaved) {
          showToast('üì¶ Data disimpan offline, akan dikirim saat internet tersambung');
          updateOfflineCounter();
          showOfflineStorage();
        } else {
          showToast('‚ö†Ô∏è Gagal menyimpan data offline');
        }
      }
      
      // Reset form
      kecamatanSelect.value = '';
      kecamatanCustom.value = '';
      kecamatanCustom.style.display = 'none';
      desaSelect.value = '';
      desaCustom.value = '';
      desaCustom.style.display = 'none';
      
      // Reset pendidikan
      pendidikanSelect.value = '';
      pendidikanCustom.value = '';
      pendidikanCustom.style.display = 'none';
      document.getElementById('namaLayananPendidikan').value = '';
      
      // Reset kesehatan
      kesehatanSelect.value = '';
      kesehatanCustom.value = '';
      kesehatanCustom.style.display = 'none';
      document.getElementById('namaLayananKesehatan').value = '';
      
      // Unlock both services after reset
      pendidikanSelect.disabled = false;
      pendidikanSelect.style.opacity = '1';
      pendidikanSelect.style.cursor = 'pointer';
      pendidikanCustom.disabled = false;
      pendidikanCustom.style.opacity = '1';
      document.getElementById('namaLayananPendidikan').disabled = false;
      document.getElementById('namaLayananPendidikan').style.opacity = '1';
      
      kesehatanSelect.disabled = false;
      kesehatanSelect.style.opacity = '1';
      kesehatanSelect.style.cursor = 'pointer';
      kesehatanCustom.disabled = false;
      kesehatanCustom.style.opacity = '1';
      document.getElementById('namaLayananKesehatan').disabled = false;
      document.getElementById('namaLayananKesehatan').style.opacity = '1';
      
      document.getElementById('sinyalSelect').value = '';
      document.getElementById('plnSelect').value = '';
      document.getElementById('jangkauanSelect').value = '';
      
      saveBtn.disabled = false;
      saveBtn.innerHTML = `üìç ${window.elementSdk?.config?.save_button_text || defaultConfig.save_button_text}`;
    }
    

    
    // Event listeners
    document.getElementById('saveBtn').addEventListener('click', saveCoordinate);
    

    
    // Handle custom input for kecamatan
    document.getElementById('kecamatanSelect').addEventListener('change', (e) => {
      const customInput = document.getElementById('kecamatanCustom');
      if (e.target.value === 'lainnya') {
        customInput.style.display = 'block';
        customInput.required = true;
      } else {
        customInput.style.display = 'none';
        customInput.required = false;
        customInput.value = '';
      }
    });
    
    // Handle custom input for desa
    document.getElementById('desaSelect').addEventListener('change', (e) => {
      const customInput = document.getElementById('desaCustom');
      if (e.target.value === 'lainnya') {
        customInput.style.display = 'block';
        customInput.required = true;
      } else {
        customInput.style.display = 'none';
        customInput.required = false;
        customInput.value = '';
      }
    });
    
    // Handle custom input for layanan pendidikan
    document.getElementById('pendidikanSelect').addEventListener('change', (e) => {
      const customInput = document.getElementById('pendidikanCustom');
      const kesehatanSelect = document.getElementById('kesehatanSelect');
      const kesehatanCustom = document.getElementById('kesehatanCustom');
      const namaKesehatan = document.getElementById('namaLayananKesehatan');
      
      if (e.target.value === 'lainnya') {
        customInput.style.display = 'block';
        customInput.required = true;
      } else {
        customInput.style.display = 'none';
        customInput.required = false;
        customInput.value = '';
      }
      
      // Lock/unlock layanan kesehatan based on pendidikan selection
      if (e.target.value && e.target.value !== '') {
        // Pendidikan dipilih, kunci kesehatan
        kesehatanSelect.disabled = true;
        kesehatanSelect.style.opacity = '0.5';
        kesehatanSelect.style.cursor = 'not-allowed';
        kesehatanCustom.disabled = true;
        kesehatanCustom.style.opacity = '0.5';
        namaKesehatan.disabled = true;
        namaKesehatan.style.opacity = '0.5';
        
        // Reset nilai kesehatan
        kesehatanSelect.value = '';
        kesehatanCustom.value = '';
        kesehatanCustom.style.display = 'none';
        namaKesehatan.value = '';
      } else {
        // Pendidikan tidak dipilih, buka kunci kesehatan
        kesehatanSelect.disabled = false;
        kesehatanSelect.style.opacity = '1';
        kesehatanSelect.style.cursor = 'pointer';
        kesehatanCustom.disabled = false;
        kesehatanCustom.style.opacity = '1';
        namaKesehatan.disabled = false;
        namaKesehatan.style.opacity = '1';
      }
    });
    
    // Handle custom input for layanan kesehatan
    document.getElementById('kesehatanSelect').addEventListener('change', (e) => {
      const customInput = document.getElementById('kesehatanCustom');
      const pendidikanSelect = document.getElementById('pendidikanSelect');
      const pendidikanCustom = document.getElementById('pendidikanCustom');
      const namaPendidikan = document.getElementById('namaLayananPendidikan');
      
      if (e.target.value === 'lainnya') {
        customInput.style.display = 'block';
        customInput.required = true;
      } else {
        customInput.style.display = 'none';
        customInput.required = false;
        customInput.value = '';
      }
      
      // Lock/unlock layanan pendidikan based on kesehatan selection
      if (e.target.value && e.target.value !== '') {
        // Kesehatan dipilih, kunci pendidikan
        pendidikanSelect.disabled = true;
        pendidikanSelect.style.opacity = '0.5';
        pendidikanSelect.style.cursor = 'not-allowed';
        pendidikanCustom.disabled = true;
        pendidikanCustom.style.opacity = '0.5';
        namaPendidikan.disabled = true;
        namaPendidikan.style.opacity = '0.5';
        
        // Reset nilai pendidikan
        pendidikanSelect.value = '';
        pendidikanCustom.value = '';
        pendidikanCustom.style.display = 'none';
        namaPendidikan.value = '';
      } else {
        // Kesehatan tidak dipilih, buka kunci pendidikan
        pendidikanSelect.disabled = false;
        pendidikanSelect.style.opacity = '1';
        pendidikanSelect.style.cursor = 'pointer';
        pendidikanCustom.disabled = false;
        pendidikanCustom.style.opacity = '1';
        namaPendidikan.disabled = false;
        namaPendidikan.style.opacity = '1';
      }
    });
    
    function showOfflineStorage() {
      const offlineStorage = document.getElementById('offlineStorage');
      if (offlineStorage) {
        offlineStorage.style.display = 'block';
      }
    }
    
    function hideOfflineStorage() {
      const offlineStorage = document.getElementById('offlineStorage');
      if (offlineStorage) {
        offlineStorage.style.display = 'none';
      }
    }
    
    async function autoSyncWhenOnline() {
      const offlineData = getOfflineData();
      if (offlineData.length === 0) return;
      
      showToast('üîÑ Menyinkronkan data offline...');
      
      const syncResult = await syncOfflineData();
      if (syncResult.success && syncResult.synced > 0) {
        showToast(`‚úÖ ${syncResult.synced} data berhasil dikirim ke Google Sheets!`);
        if (syncResult.remaining === 0) {
          hideOfflineStorage();
        }
      } else if (syncResult.failed > 0) {
        showToast(`‚ö†Ô∏è ${syncResult.failed} data gagal dikirim, akan dicoba lagi nanti`);
      }
    }
    
    async function manualSync() {
      const syncBtn = document.getElementById('syncBtn');
      if (!checkInternetConnection()) {
        showToast('‚ùå Tidak ada koneksi internet');
        return;
      }
      
      const offlineData = getOfflineData();
      if (offlineData.length === 0) {
        showToast('‚úÖ Tidak ada data offline untuk disinkronkan');
        return;
      }
      
      syncBtn.disabled = true;
      syncBtn.innerHTML = 'üîÑ Menyinkronkan...';
      
      const syncResult = await syncOfflineData();
      
      if (syncResult.success && syncResult.synced > 0) {
        showToast(`‚úÖ ${syncResult.synced} data berhasil dikirim ke Google Sheets!`);
        if (syncResult.remaining === 0) {
          hideOfflineStorage();
        }
      } else if (syncResult.failed > 0) {
        showToast(`‚ö†Ô∏è ${syncResult.failed} data gagal dikirim`);
      } else {
        showToast('‚ùå Gagal menyinkronkan data');
      }
      
      syncBtn.disabled = false;
      syncBtn.innerHTML = 'üîÑ Sinkron Sekarang';
    }
    
    // Dropdown functionality
    function toggleDropdown(id) {
      const content = document.getElementById(`content-${id}`);
      const arrow = document.getElementById(`arrow-${id}`);
      const header = content.previousElementSibling;
      
      if (content.classList.contains('open')) {
        // Close dropdown
        content.classList.remove('open');
        arrow.classList.remove('rotated');
        header.classList.remove('active');
      } else {
        // Close all other dropdowns first
        const allContents = document.querySelectorAll('.dropdown-content');
        const allArrows = document.querySelectorAll('.dropdown-arrow');
        const allHeaders = document.querySelectorAll('.dropdown-header');
        
        allContents.forEach(c => c.classList.remove('open'));
        allArrows.forEach(a => a.classList.remove('rotated'));
        allHeaders.forEach(h => h.classList.remove('active'));
        
        // Open this dropdown
        content.classList.add('open');
        arrow.classList.add('rotated');
        header.classList.add('active');
      }
    }

    async function init() {
      console.log('Initializing app...');
      console.log('Data SDK available:', !!window.dataSdk);
      console.log('Element SDK available:', !!window.elementSdk);
      
      // Wait a bit for SDKs to load
      await new Promise(resolve => setTimeout(resolve, 100));
      
      // Initialize offline storage UI
      updateOfflineCounter();
      const offlineData = getOfflineData();
      if (offlineData.length > 0) {
        showOfflineStorage();
      }
      
      // Initialize Data SDK - silent operation
      if (window.dataSdk) {
        console.log('Initializing Data SDK...');
        try {
          const initResult = await window.dataSdk.init(dataHandler);
          console.log('Data SDK init result:', initResult);
        } catch (error) {
          console.error('Error initializing Data SDK:', error);
        }
      }
      
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.primary_color || defaultConfig.primary_color,
                set: (value) => {
                  config.primary_color = value;
                  window.elementSdk.setConfig({ primary_color: value });
                }
              },
              {
                get: () => config.background_gradient_start || defaultConfig.background_gradient_start,
                set: (value) => {
                  config.background_gradient_start = value;
                  window.elementSdk.setConfig({ background_gradient_start: value });
                }
              },
              {
                get: () => config.background_gradient_end || defaultConfig.background_gradient_end,
                set: (value) => {
                  config.background_gradient_end = value;
                  window.elementSdk.setConfig({ background_gradient_end: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["save_button_text", config.save_button_text || defaultConfig.save_button_text],
            ["empty_message", config.empty_message || defaultConfig.empty_message],
            ["location_title", config.location_title || defaultConfig.location_title],
            ["manual_title", config.manual_title || defaultConfig.manual_title]
          ])
        });
      }
      
      // Start location tracking
      startLocationWatch();
    }
    
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99909213c1fca12f',t:'MTc2MjIyMjE4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
